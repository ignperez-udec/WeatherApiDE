version: 2

models:
  - name: dim_locations
    columns:
      - name: cod_location
        tests:
          - not_null
          - unique

  - name: dim_date
    columns:
      - name: id
        tests:
          - not_null
          - unique

  - name: dim_weather_code_wmo
    columns:
      - name: code
        tests:
          - not_null
          - unique

  - name: dim_koppen_classes
    columns:
      - name: class
        tests:
          - not_null
          - unique

  - name: dim_koppen_subclasses
    columns:
      - name: code
        tests:
          - not_null
          - unique

  - name: fact_weather
    columns:
      - name: id
        tests:
          - not_null
          - unique
      - name: cod_location
        tests:
          - relationships:
              to: ref('dim_locations')
              field: cod_location
      - name: date_id
        tests:
          - relationships:
              to: ref('dim_date')
              field: id
      - name: temperature_max
        tests:
          - not_null
      - name: temperature_min
        tests:
          - not_null
      - name: temperature_mean
        tests:
          - not_null
      - name: precipitation_sum
        tests:
          - not_null
      - name: weather_code
        tests:
          - not_null
          - relationships:
              to: ref('dim_weather_code_wmo')
              field: code

  - name: fact_koppen_model
    columns:
      - name: id
        tests:
          - not_null
          - unique
      - name: cod_location
        tests:
          - relationships:
              to: ref('dim_locations')
              field: cod_location
      - name: koppen_class
        tests:
          - not_null
          - relationships:
              to: ref('dim_koppen_classes')
              field: class
      - name: koppen_subclass
        tests:
          - not_null
          - relationships:
              to: ref('dim_koppen_subclasses')
              field: code